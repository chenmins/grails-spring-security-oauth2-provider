<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>4 Required Domain Classes 3.2.2.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        spring-security-oauth2-provider
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security OAuth2 Plugin</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/exampleFlows.html"><strong>3</strong><span>Example Flows</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/domainClasses.html"><strong>4</strong><span>Required Domain Classes</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/optionalDomainClasses.html"><strong>5</strong><span>Optional Domain Classes</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/domainClassProperties.html"><strong>6</strong><span>Domain Class Properties</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/configuration.html"><strong>7</strong><span>Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/standaloneResourceAuthorizationServer.html"><strong>8</strong><span>Standalone Resource Server or Authorization Server</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/exampleFlows.html">&lt;&lt; <strong>3</strong><span>Example Flows</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/optionalDomainClasses.html"><strong>5</strong><span>Optional Domain Classes</span> >></a></div>
                


                <div class="project">
                    <h1>4 Required Domain Classes</h1>

                    <p><strong>Version:</strong> 3.2.2.BUILD-SNAPSHOT</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#clientClass"><strong>4.1</strong><span>Client Class</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#accessTokenClass"><strong>4.2</strong><span>Access Token Class</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#refreshTokenClass"><strong>4.3</strong><span>Refresh Token Class</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#authorizationCodeClass"><strong>4.4</strong><span>Authorization Code Class</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="domainClasses">4 Required Domain Classes</h1>


The plugin uses regular Grails domain classes backed by GORM. There are four required domain classes representing clients, access tokens, refresh tokens and authorization codes that you'll need.<p class="paragraph"/>The <a href="../ref/Scripts/s2-init-oauth2-provider.html" class="Scripts">s2-init-oauth2-provider</a> script will create the domain classes for you in a specified package and update <code>grails-app/conf/application.groovy</code> so the plugin recognizes them. You can customize the generated classes to fit your needs. If you change the default property names, you will need to update <code>grails-app/conf/application.groovy</code> so the plugin is aware of the changes. See the section on <a href="../guide/single.html#domainClassProperties" class="guide">domain class properties</a> for more information.<p class="paragraph"/><blockquote class="note">
The <code>maxSize</code> constraints in the generated domain classes have been set to reasonable defaults. However, tweaking may
be required if you are using longer usernames (email addresses for example), or have many authorities attached to a
single user.
</blockquote><p class="paragraph"/>The below discussion assumes the <a href="../ref/Scripts/s2-init-oauth2-provider.html" class="Scripts">s2-init-oauth2-provider</a> script has been run with <code>com.yourapp</code> specified as the package and <code>Client</code>, <code>AccessToken</code>, <code>RefreshToken</code> and <code>AuthorizationCode</code> as the names of your domain classes.


<h2 id="clientClass">4.1 Client Class</h2>


Information from the Grails client domain class will be extracted to create a <code>ClientDetails</code> instance for the underlying Spring Security OAuth 2.0 implementation.<p class="paragraph"/>The generated class will look like this:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.yourapp<p class="paragraph"/>class Client &#123;<p class="paragraph"/>    <span class="java&#45;keyword">private</span> <span class="java&#45;keyword">static</span> <span class="java&#45;keyword">final</span> <span class="java&#45;object">String</span> NO_CLIENT_SECRET = ''<p class="paragraph"/>    <span class="java&#45;keyword">transient</span> springSecurityService<p class="paragraph"/>    <span class="java&#45;object">String</span> clientId
    <span class="java&#45;object">String</span> clientSecret<p class="paragraph"/>    <span class="java&#45;object">Integer</span> accessTokenValiditySeconds
    <span class="java&#45;object">Integer</span> refreshTokenValiditySeconds<p class="paragraph"/>    Map&#60;<span class="java&#45;object">String</span>, <span class="java&#45;object">Object</span>&#62; additionalInformation<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasMany = &#91;
            authorities: <span class="java&#45;object">String</span>,
            authorizedGrantTypes: <span class="java&#45;object">String</span>,
            resourceIds: <span class="java&#45;object">String</span>,
            scopes: <span class="java&#45;object">String</span>,
            autoApproveScopes: <span class="java&#45;object">String</span>,
            redirectUris: <span class="java&#45;object">String</span>
    &#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> transients = &#91;'springSecurityService'&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        clientId blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        clientSecret nullable: <span class="java&#45;keyword">true</span><p class="paragraph"/>        accessTokenValiditySeconds nullable: <span class="java&#45;keyword">true</span>
        refreshTokenValiditySeconds nullable: <span class="java&#45;keyword">true</span><p class="paragraph"/>        authorities nullable: <span class="java&#45;keyword">true</span>
        authorizedGrantTypes nullable: <span class="java&#45;keyword">true</span><p class="paragraph"/>        resourceIds nullable: <span class="java&#45;keyword">true</span><p class="paragraph"/>        scopes nullable: <span class="java&#45;keyword">true</span>
        autoApproveScopes nullable: <span class="java&#45;keyword">true</span><p class="paragraph"/>        redirectUris nullable: <span class="java&#45;keyword">true</span>
        additionalInformation nullable: <span class="java&#45;keyword">true</span>
    &#125;<p class="paragraph"/>    def beforeInsert() &#123;
        encodeClientSecret()
    &#125;<p class="paragraph"/>    def beforeUpdate() &#123;
        <span class="java&#45;keyword">if</span>(isDirty('clientSecret')) &#123;
            encodeClientSecret()
        &#125;
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">protected</span> void encodeClientSecret() &#123;
        clientSecret = clientSecret ?: NO_CLIENT_SECRET
        clientSecret = springSecurityService?.passwordEncoder ? springSecurityService.encodePassword(clientSecret) : clientSecret
    &#125;
&#125;</pre></div><p class="paragraph"/>The client secret is encoded using the same strategy that is configured by the Core plugin for handling passwords. Optional client secrets are also supported out of the box.


<h2 id="accessTokenClass">4.2 Access Token Class</h2>


This class represents an access token than has been issued to a client on behalf of a user. The authentication object serialized is an instance of <code>OAuth2Authentication</code> from Spring Security OAuth 2.0.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.yourapp<p class="paragraph"/>class AccessToken &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> authenticationKey
    <span class="java&#45;object">byte</span>&#91;&#93; authentication<p class="paragraph"/>    <span class="java&#45;object">String</span> username
    <span class="java&#45;object">String</span> clientId<p class="paragraph"/>    <span class="java&#45;object">String</span> value
    <span class="java&#45;object">String</span> tokenType<p class="paragraph"/>    Date expiration
    Map&#60;<span class="java&#45;object">String</span>, <span class="java&#45;object">Object</span>&#62; additionalInformation<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasOne = &#91;refreshToken: <span class="java&#45;object">String</span>&#93;
    <span class="java&#45;keyword">static</span> hasMany = &#91;scope: <span class="java&#45;object">String</span>&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        username nullable: <span class="java&#45;keyword">true</span>
        clientId nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>
        value nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        tokenType nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>
        expiration nullable: <span class="java&#45;keyword">false</span>
        scope nullable: <span class="java&#45;keyword">false</span>
        refreshToken nullable: <span class="java&#45;keyword">true</span>
        authenticationKey nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        authentication nullable: <span class="java&#45;keyword">false</span>, minSize: 1, maxSize: 1024 &#42; 4
        additionalInformation nullable: <span class="java&#45;keyword">true</span>
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        version <span class="java&#45;keyword">false</span>
        scope lazy: <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div>


<h2 id="refreshTokenClass">4.3 Refresh Token Class</h2>


This class represents a refresh token issued as part of one of the grants that supports issuing a refresh token. The length of time the refresh token is valid is determined by the token services and can be configured. See <a href="../guide/single.html#tokenServices" class="guide">token services configuration</a> for more. The authentication object serialized is an instance of <code>OAuth2Authentication</code> from Spring Security OAuth 2.0.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.yourapp<p class="paragraph"/>class RefreshToken &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> value
    Date expiration
    <span class="java&#45;object">byte</span>&#91;&#93; authentication<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        value nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        expiration nullable: <span class="java&#45;keyword">true</span>
        authentication nullable: <span class="java&#45;keyword">false</span>, minSize: 1, maxSize: 1024 &#42; 4
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        version <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>If a non-expiring refresh token is desired, the client issuing the refresh token should be configured to return a 0 or less for the refresh token validity length in accordance with the behavior of Spring Security OAuth beginning with 2.0.6.RELEASE. A non-expiring GORM refresh token will be stored with a <code>null</code> expiration. When reading a GORM refresh token, if the expiration field is <code>null</code>, an <code>ExpiringOAuth2RefreshToken</code> instance will be created and returned for processing by Spring Security OAuth. Otherwise an instance of <code>OAuth2RefreshToken</code> will be created and used.



<h2 id="authorizationCodeClass">4.4 Authorization Code Class</h2>


This class represents an authorization code that has been issued via the authorization endpoint as part of an authorization code grant. The authentication object serialized is an instance of <code>OAuth2Authentication</code> from Spring Security OAuth 2.0.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.yourapp<p class="paragraph"/>class AuthorizationCode &#123;<p class="paragraph"/>    <span class="java&#45;object">byte</span>&#91;&#93; authentication
    <span class="java&#45;object">String</span> code<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        code nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        authentication nullable: <span class="java&#45;keyword">false</span>, minSize: 1, maxSize: 1024 &#42; 4
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        version <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/exampleFlows.html">&lt;&lt; <strong>3</strong><span>Example Flows</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/optionalDomainClasses.html"><strong>5</strong><span>Optional Domain Classes</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-init-oauth2-approval.html">s2-init-oauth2-approval</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-init-oauth2-provider.html">s2-init-oauth2-provider</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
