<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script src="/cdn-cgi/apps/head/3cOPSgo5Omz84ycX7CvigfX4cpw.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-82213539-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-82213539-2');
    </script>
    <title>2.6 Controlling Access to Resources 4.0.0.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        spring-security-oauth2-provider
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security OAuth2 Plugin</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/exampleFlows.html"><strong>3</strong><span>Example Flows</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/domainClasses.html"><strong>4</strong><span>Required Domain Classes</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/optionalDomainClasses.html"><strong>5</strong><span>Optional Domain Classes</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/domainClassProperties.html"><strong>6</strong><span>Domain Class Properties</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/configuration.html"><strong>7</strong><span>Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/standaloneResourceAuthorizationServer.html"><strong>8</strong><span>Standalone Resource Server or Authorization Server</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/introduction.html">&lt;&lt; <strong>1</strong><span>Introduction to the Spring Security OAuth2 Plugin</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/exampleFlows.html"><strong>3</strong><span>Example Flows</span> >></a></div>
                


                <div class="project">
                    <h1>2.6 Controlling Access to Resources</h1>

                    <p><strong>Version:</strong> 4.0.0.BUILD-SNAPSHOT</p>
                </div>

                

                

<h2 id="resourceAccess">2.6 Controlling Access to Resources</h2>


Access to resources is controlled by the Spring Security Core plugin's access control mechanisms. Additionally, the plugin has full support for the OAuth 2.0 SPeL extensions provided by the underlying Spring library. Refer to the methods in <a href="https://github.com/spring-projects/spring-security-oauth/blob/2.0.2.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/expression/OAuth2SecurityExpressionMethods.java" target="blank">OAuth2SecurityExpressionMethods</a> for what is available in the plugin.<p class="paragraph"/>Using SPeL is the only tested and confirmed way to enforce OAuth 2.0 specific restrictions on resource access.<p class="paragraph"/>The following controller illustrates the use of OAuth 2.0 SPeL:<p class="paragraph"/><div class="code"><pre>class SecuredOAuth2ResourcesController &#123;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"&#35;oauth2.clientHasRole('ROLE_CLIENT')"</span>&#93;)
    def clientRoleExpression() &#123;
        render <span class="java&#45;quote">"client role expression"</span>
    &#125;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"ROLE_CLIENT"</span>&#93;)
    def clientRole() &#123;
        render <span class="java&#45;quote">"client role"</span>
    &#125;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"&#35;oauth2.clientHasAnyRole('ROLE_CLIENT', 'ROLE_TRUSTED_CLIENT')"</span>&#93;)
    def clientHasAnyRole() &#123;
        render <span class="java&#45;quote">"client has any role"</span>
    &#125;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"&#35;oauth2.isClient()"</span>&#93;)
    def client() &#123;
        render <span class="java&#45;quote">"is client"</span>
    &#125;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"&#35;oauth2.isUser()"</span>&#93;)
    def user() &#123;
        render <span class="java&#45;quote">"is user"</span>
    &#125;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"&#35;oauth2.denyOAuthClient()"</span>&#93;)
    def denyClient() &#123;
        render <span class="java&#45;quote">"no client can see"</span>
    &#125;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"permitAll"</span>&#93;)
    def anyone() &#123;
        render <span class="java&#45;quote">"anyone can see"</span>
    &#125;<p class="paragraph"/>    def nobody() &#123;
        render <span class="java&#45;quote">"nobody can see"</span>
    &#125;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"&#35;oauth2.clientHasRole('ROLE_TRUSTED_CLIENT') and &#35;oauth2.isClient() and &#35;oauth2.hasScope('trust')"</span>&#93;)
    def trustedClient() &#123;
        render <span class="java&#45;quote">"trusted client"</span>
    &#125;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"hasRole('ROLE_USER') and &#35;oauth2.isUser() and &#35;oauth2.hasScope('trust')"</span>&#93;)
    def trustedUser() &#123;
        render <span class="java&#45;quote">"trusted user"</span>
    &#125;<p class="paragraph"/>    @Secured(&#91;<span class="java&#45;quote">"hasRole('ROLE_USER') or &#35;oauth2.hasScope('read')"</span>&#93;)
    def userRoleOrReadScope() &#123;
        render <span class="java&#45;quote">"user role or read scope"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The filter chains must be configured to ensure stateless access to the token endpoint and any OAuth 2.0 resources:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.filterChain.chainMap = &#91;
        &#91;pattern: '/oauth/token',               filters: 'JOINED_FILTERS,&#45;oauth2ProviderFilter,&#45;securityContextPersistenceFilter,&#45;logoutFilter,&#45;authenticationProcessingFilter,&#45;rememberMeAuthenticationFilter,&#45;exceptionTranslationFilter'&#93;,
        &#91;pattern: '/securedOAuth2Resources/&#42;&#42;', filters: 'JOINED_FILTERS,&#45;securityContextPersistenceFilter,&#45;logoutFilter,&#45;authenticationProcessingFilter,&#45;rememberMeAuthenticationFilter,&#45;oauth2BasicAuthenticationFilter,&#45;exceptionTranslationFilter'&#93;,
        &#91;pattern: '/&#42;&#42;',                        filters: 'JOINED_FILTERS,&#45;statelessSecurityContextPersistenceFilter,&#45;oauth2ProviderFilter,&#45;clientCredentialsTokenEndpointFilter,&#45;oauth2BasicAuthenticationFilter,&#45;oauth2ExceptionTranslationFilter'&#93;
&#93;</pre></div><p class="paragraph"/>Please consult the section on <a href="../guide/single.html#filterChainConfig" class="guide">Filter Chain Configuration</a> for more information.


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/introduction.html">&lt;&lt; <strong>1</strong><span>Introduction to the Spring Security OAuth2 Plugin</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/exampleFlows.html"><strong>3</strong><span>Example Flows</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/Scripts/s2-init-oauth2-approval.html">s2-init-oauth2-approval</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Scripts/s2-init-oauth2-provider.html">s2-init-oauth2-provider</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
