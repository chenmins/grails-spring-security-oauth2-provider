<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>7.9 Filter Chain Configuration 3.2.1.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        spring-security-oauth2-provider
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security OAuth2 Plugin</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/exampleFlows.html"><strong>3</strong><span>Example Flows</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/domainClasses.html"><strong>4</strong><span>Required Domain Classes</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/optionalDomainClasses.html"><strong>5</strong><span>Optional Domain Classes</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/domainClassProperties.html"><strong>6</strong><span>Domain Class Properties</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/configuration.html"><strong>7</strong><span>Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/standaloneResourceAuthorizationServer.html"><strong>8</strong><span>Standalone Resource Server or Authorization Server</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/domainClassProperties.html">&lt;&lt; <strong>6</strong><span>Domain Class Properties</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/standaloneResourceAuthorizationServer.html"><strong>8</strong><span>Standalone Resource Server or Authorization Server</span> >></a></div>
                


                <div class="project">
                    <h1>7.9 Filter Chain Configuration</h1>

                    <p><strong>Version:</strong> 3.2.1.BUILD-SNAPSHOT</p>
                </div>

                

                

<h2 id="filterChainConfig">7.9 Filter Chain Configuration</h2>


Spring Security Core plugin's <code>securityContextPersistenceFilter</code> stores state in the HTTP session. Access to the token endpoint and OAuth 2.0 resources must be stateless.<p class="paragraph"/>By default, the OAuth2 plugin will register the <code>statelessSecurityContextPersistenceFilter</code> in the filter chain after the <code>securityContextPersistenceFilter</code> provided by the Spring Security Core plugin. This is provided as a convenience for the plugin consumer, so they can remove one filter or the other to easily achieve stateful or stateless request handling. See the example below. This automatic filter registration can be disabled by setting the <code>registerStatelessFilter</code> configuration option to <code>false</code>.<p class="paragraph"/>The plugin registers an <code>OAuth2AuthenticationProcessingFilter</code> under the bean name <code>oauth2ProviderFilter</code>. This filter provides token authentication using the underlying token store for resource access.<p class="paragraph"/>The plugin registers a <code>ClientCredentialsTokenEndpointFilter</code> under the bean name <code>clientCredentialsTokenEndpointFilter</code>. This filter is responsible for authenticating the client specified in any OAuth 2.0 requests. The plugin also registers a <code>BasicAuthenticationFilter</code> under the bean name <code>oauth2BasicAuthenticationFilter</code>. This filter is responsible for authenticating the client via HTTP Basic authentication, which is the recommended method in the OAuth 2.0 specification.<p class="paragraph"/>Finally, the plugin registers an <code>ExceptionTranslationFilter</code> under the bean name <code>oauth2ExceptionTranslationFilter</code>. This filter is created with a <code>NullRequestCache</code> instance rather than the <code>HttpSessionRequestCache</code> instance that the Spring Security Core plugin provided <code>ExceptionTranslationFilter</code> is created with. Similar to the <code>statelessSecurityContextPersistenceFilter</code>, this filter is registered automatically by the plugin but can be disabled by setting the <code>registerExceptionTranslationFilter</code> configuration option to <code>false</code>.<p class="paragraph"/>The following filter chain configuration is recommended:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.filterChain.chainMap = &#91;
        &#91;pattern: '/oauth/token',               filters: 'JOINED_FILTERS,&#45;oauth2ProviderFilter,&#45;securityContextPersistenceFilter,&#45;logoutFilter,&#45;authenticationProcessingFilter,&#45;rememberMeAuthenticationFilter,&#45;exceptionTranslationFilter'&#93;,
        &#91;pattern: '/securedOAuth2Resources/&#42;&#42;', filters: 'JOINED_FILTERS,&#45;securityContextPersistenceFilter,&#45;logoutFilter,&#45;authenticationProcessingFilter,&#45;rememberMeAuthenticationFilter,&#45;oauth2BasicAuthenticationFilter,&#45;exceptionTranslationFilter'&#93;,
        &#91;pattern: '/&#42;&#42;',                        filters: 'JOINED_FILTERS,&#45;statelessSecurityContextPersistenceFilter,&#45;oauth2ProviderFilter,&#45;clientCredentialsTokenEndpointFilter,&#45;oauth2BasicAuthenticationFilter,&#45;oauth2ExceptionTranslationFilter'&#93;
&#93;</pre></div><p class="paragraph"/>The <code>oauth2ProviderFilter</code> and stateful <code>securityContextPersistenceFilter</code> and <code>exceptionTranslationFilter</code> are removed from the token endpoint's filter chain. With the <code>securityContextPersistenceFilter</code> removed, the <code>statelessSecurityContextPersistenceFilter</code> will be used to ensure access token requests are stateless. Similarly, removing the <code>exceptionTranslationFilter</code> will allow the <code>oauth2ExceptionTranslationFilter</code> to take its place in the filter chain.<p class="paragraph"/>The <code>securityContextPersistenceFilter</code> and <code>exceptionTranslationFilter</code> are also removed from the filter chain for OAuth 2.0 resources. However, the <code>oauth2ProviderFilter</code> must not be removed, as this filter is responsible for authenticating the OAuth 2.0 access token included in the request.<p class="paragraph"/>It is recommend that filter chain(s) for non-OAuth 2.0 resources have all OAuth 2.0 specific filters removed. These include: <code>statelessSecurityContextPersistenceFilter</code>, <code>oauth2ProviderFilter</code>, <code>clientCredentialsTokenEndpointFilter</code>, <code>basicAuthenticationFilter</code> and <code>oauth2ExceptionTranslationFilter</code>. It is also recommended that any unnecessary filters such as the <code>rememberMeAuthenticationFilter</code> and <code>authenticationProcessingFilter</code> are removed from the filter chains for the token endpoint and OAuth 2.0 resources.


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/domainClassProperties.html">&lt;&lt; <strong>6</strong><span>Domain Class Properties</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/standaloneResourceAuthorizationServer.html"><strong>8</strong><span>Standalone Resource Server or Authorization Server</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/Scripts/s2-init-oauth2-approval.html">s2-init-oauth2-approval</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Scripts/s2-init-oauth2-provider.html">s2-init-oauth2-provider</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
