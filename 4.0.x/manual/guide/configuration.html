<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script src="/cdn-cgi/apps/head/3cOPSgo5Omz84ycX7CvigfX4cpw.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-82213539-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-82213539-2');
    </script>
    <title>7 Configuration 4.0.0-RC1</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        spring-security-oauth2-provider
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security OAuth2 Plugin</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/exampleFlows.html"><strong>3</strong><span>Example Flows</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/domainClasses.html"><strong>4</strong><span>Required Domain Classes</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/optionalDomainClasses.html"><strong>5</strong><span>Optional Domain Classes</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/domainClassProperties.html"><strong>6</strong><span>Domain Class Properties</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/configuration.html"><strong>7</strong><span>Configuration</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/standaloneResourceAuthorizationServer.html"><strong>8</strong><span>Standalone Resource Server or Authorization Server</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/domainClassProperties.html">&lt;&lt; <strong>6</strong><span>Domain Class Properties</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/standaloneResourceAuthorizationServer.html"><strong>8</strong><span>Standalone Resource Server or Authorization Server</span> >></a></div>
                


                <div class="project">
                    <h1>7 Configuration</h1>

                    <p><strong>Version:</strong> 4.0.0-RC1</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#plugin"><strong>7.1</strong><span>Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#endpoints"><strong>7.2</strong><span>Endpoint URLs</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#tokenServices"><strong>7.3</strong><span>Token Services</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#tokenEnhancers"><strong>7.4</strong><span>Token Enhancers Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#grantTypes"><strong>7.5</strong><span>Supported Grant Types</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#authorization"><strong>7.6</strong><span>Additional Authorization Constraints</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#approvalHandler"><strong>7.7</strong><span>User Approval Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#defaultClientConfig"><strong>7.8</strong><span>Default Client Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#filterChainConfig"><strong>7.9</strong><span>Filter Chain Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#domainClassCustomSerializationConfig"><strong>7.10</strong><span>Domain Class Custom Serialization Configuration</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="configuration">7 Configuration</h1>


The plugin is pessimistic by default, locking down as much as possible to guard against accidental security breaches. However, these constraints can be modified if so desired in <code>grails-app/conf/application.groovy</code>. The properties below exist in the <code>grails.plugin.springsecurity.oauthProvider</code> namespace.


<h2 id="plugin">7.1 Plugin</h2>


The following properties define whether the plugin is active and where the required filters are registered in the Spring Security filter chain:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default Value</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>active</td><td><code>true</code></td><td>Whether the plugin is enabled.</td></tr><tr class="table-even"><td>filterStartPosition</td><td><code>SecurityFilterPosition.X509_FILTER.order</code></td><td>The position in the filter chain of the <code>OAuth2AuthenticationProcessingFilter</code>, which handles authentication for resource access by extracting an access token from the incoming request.</td></tr><tr class="table-odd"><td>clientFilterStartPosition</td><td><code>SecurityFilterPosition.DIGEST_AUTH_FILTER.order</code></td><td>The position in the filter chain of the <code>ClientCredentialsTokenEndpointFilter</code>, which handles client authentication.</td></tr><tr class="table-even"><td>statelessFilterStartPosition</td><td><code>SecurityFilterPosition.SECURITY_CONTEXT_FILTER.order</code></td><td>The position in the filter chain of the <code>StatelessSecurityContextPersistenceFilter</code>, which is used to ensure access to OAuth 2.0 resources and the token endpoint are stateless.</td></tr><tr class="table-odd"><td>exceptionTranslationFilterStartPosition</td><td><code>SecurityFilterPosition.EXCEPTION_TRANSLATION_FILTER.order</code></td><td>The position in the filter chain of the <code>ExceptionTranslationFilter</code> configured with a <code>NullRequestCache</code>, which is used to ensure access to OAuth 2.0 resources and the token endpoint are stateless.</td></tr><tr class="table-even"><td>basicAuthenticationFilterStartPosition</td><td><code>SecurityFilterPosition.BASIC_AUTH_FILTER.order</code></td><td>The position in the filter chain of the <code>BasicAuthenticationFilter</code> configured with a <code>NullRememberMeServices</code>, which is used to ensure access to OAuth 2.0 resources and the token endpoint are stateless.</td></tr><tr class="table-odd"><td>registerStatelessFilter</td><td><code>true</code></td><td>When this is <code>true</code>, the plugin will register the <code>statelessSecurityContextPersistenceFilter</code> in the filter chain after the <code>securityContextPersistenceFilter</code> provided by the Spring Security Core plugin. See <a href="../guide/single.html#filterChainConfig" class="guide">below</a> for additional configuration of the filter chain(s) required to properly secure access to OAuth 2.0 resources.</td></tr><tr class="table-even"><td>registerExceptionTranslationFilter</td><td><code>true</code></td><td>When this is <code>true</code>, the plugin will register the <code>oauth2ExceptionTranslationFilter</code> in the filter chain after the <code>exceptionTranslationFilter</code> provided by the Spring Security Core plugin. See <a href="../guide/single.html#filterChainConfig" class="guide">below</a> for additional configuration of the filter chain(s) required to properly secure access to OAuth 2.0 resources.</td></tr><tr class="table-odd"><td>registerBasicAuthenticationFilter</td><td><code>true</code></td><td>When this is <code>true</code>, the plugin will register the <code>oauth2BasicAuthenticationFilter</code> in the filter chain after the <code>basicAuthenticationFilter</code> provided by the Spring Security Core plugin. See <a href="../guide/single.html#filterChainConfig" class="guide">below</a> for additional configuration of the filter chain(s) required to properly secure access to OAuth 2.0 resources.</td></tr><tr class="table-even"><td>realmName</td><td><code>Grails OAuth2 Realm</code></td><td>Realm name included in the WWW-Authenticate header in a challenge response.</td></tr></table>


<h2 id="endpoints">7.2 Endpoint URLs</h2>


The endpoint URLs used by the underlying Spring Security OAuth 2.0 implementation can be changed using the following properties:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default Value</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>authorizationEndpointUrl</td><td><code>'/oauth/authorize'</code></td><td>Authorization endpoint URL.</td></tr><tr class="table-even"><td>tokenEndpointUrl</td><td><code>'/oauth/token'</code></td><td>Token endpoint URL.</td></tr><tr class="table-odd"><td>userApprovalEndpointUrl</td><td><code>'/oauth/confirm_access'</code></td><td>URL of the view to display for confirming access to protected resources.</td></tr><tr class="table-even"><td>userApprovalParameter</td><td><code>'user_oauth_approval'</code></td><td>The name of the parameter submitted in the confirmation request. The value of this parameter is used to determine whether a user has confirmed (<code>true</code>) or denied (<code>false</code>) access.</td></tr><tr class="table-odd"><td>errorEndpointUrl</td><td><code>'/oauth/error'</code></td><td>URL of the view to display if an error occurs while interacting with the authorization endpoint and the error cannot be returned as part of the query or fragment of the client's redirect URI. This is usually the case when there is a problem with the requesting client's redirect URI.</td></tr></table><p class="paragraph"/>When changing the URL for the <code>authorizationEndpointUrl</code> or <code>tokenEndpointUrl</code>, you <strong class="bold">must</strong> update Spring Security Core's configuration. Using the <code>staticRules</code> configuration and the default configuration as an example, your <code>grails-app/conf/Config.groovy</code> will look like this:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.controllerAnnotations.staticRules = &#91;
        &#91;pattern: '/oauth/authorize',           access: <span class="java&#45;quote">"isFullyAuthenticated() and (request.getMethod().equals('GET') or request.getMethod().equals('POST'))"</span>&#93;,
        &#91;pattern: '/oauth/token',               access: <span class="java&#45;quote">"isFullyAuthenticated() and request.getMethod().equals('POST')"</span>&#93;,
        ...</pre></div><p class="paragraph"/>To change the <code>authorizationEndpointUrl</code> to <code>/authorize</code>, you will need to make the following changes in <code>grails-app/conf/application.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.oauthProvider.authorizationEndpointUrl = '/authorize'<p class="paragraph"/>grails.plugin.springsecurity.controllerAnnotations.staticRules = &#91;
        &#91;pattern: '/authorize',                 access: <span class="java&#45;quote">"isFullyAuthenticated() and (request.getMethod().equals('GET') or request.getMethod().equals('POST'))"</span>&#93;,
        &#91;pattern: '/oauth/token',               access: <span class="java&#45;quote">"isFullyAuthenticated() and request.getMethod().equals('POST')"</span>&#93;,
        ...</pre></div>



<h2 id="tokenServices">7.3 Token Services</h2>


The following properties apply to how tokens are issued and how long they are valid. If a client has defined a specific token validity length, the client's length will take priority over the values configured for the token services.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default Value</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>tokenServices.registerTokenEnhancers</td><td><code>true</code></td><td>Whether registered <code>TokenEnhancer</code> instances should be used.</td></tr><tr class="table-even"><td>tokenServices.accessTokenValiditySeconds</td><td><code>60 &#42; 60 &#42; 12</code></td><td>The length of time that an access token will be valid after it has been issued.</td></tr><tr class="table-odd"><td>tokenServices.refreshTokenValiditySeconds</td><td><code>60 &#42; 60 &#42; 24 &#42; 30</code></td><td>The length of time that a refresh token will be valid after it has been issued.</td></tr><tr class="table-even"><td>tokenServices.reuseRefreshToken</td><td><code>false</code></td><td>Whether a new refresh token should be generated if one is currently available.</td></tr><tr class="table-odd"><td>tokenServices.supportRefreshToken</td><td><code>true</code></td><td>Whether a refresh token can be issued upon request.</td></tr></table><p class="paragraph"/>


<h2 id="tokenEnhancers">7.4 Token Enhancers Configuration</h2>


By default, the plugin will register a <code>TokenEnhancerChain</code> with an empty list of <code>TokenEnhancer</code> delegates. When the <code>tokenServices.registerTokenEnhancers</code> option is <code>true</code>, the plugin will detect and use all registered Spring beans implementing the <code>TokenEnhancer</code> interface.<p class="paragraph"/>If more control over the ordering of the enhancers in the chain is desired, set the <code>tokenServices.registerTokenEnhancers</code> option to <code>false</code>. The <code>TokenEnhancerChain</code> bean is registered under the name <code>tokenEnhancerChain</code>, so the plugin consumer can get a handle to it for more fine grained configuration.<p class="paragraph"/>This bean is aliased under the name <code>tokenEnhancer</code>. This is the bean that is registered with the <code>tokenServices</code> bean. This is done to allow customization of the registered enhancer with minimal effort. Just override the <code>tokenEnhancer</code> bean.


<h2 id="grantTypes">7.5 Supported Grant Types</h2>


The following properties determine which of the standard grant types the application can support. Individual clients <strong class="bold">must</strong> declare which of the enabled grant types they support.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default Value</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>grantTypes.authorizationCode</td><td><code>true</code></td><td>Whether the Authorization Code Grant is supported.</td></tr><tr class="table-even"><td>grantTypes.implicit</td><td><code>true</code></td><td>Whether the Implicit Grant is supported.</td></tr><tr class="table-odd"><td>grantTypes.clientCredentials</td><td><code>true</code></td><td>Whether the Client Credentials Grant is supported.</td></tr><tr class="table-even"><td>grantTypes.password</td><td><code>true</code></td><td>Whether the Resource Owner Password Credentials is supported.</td></tr><tr class="table-odd"><td>grantTypes.refreshToken</td><td><code>true</code></td><td>Whether Refresh Token Grant is supported.</td></tr></table>



<h2 id="authorization">7.6 Additional Authorization Constraints</h2>


The plugin enforces the following restrictions on authorization request params:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default Value</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>authorization.requireRegisteredRedirectUri</td><td><code>true</code></td><td>Whether a client is required to have registered a redirect URI before performing an authorization request. This addresses  <em class="italic">RFC 6749 Section 10.6: Authorization Code Redirection URI Manipulation</em>  and  <em class="italic">RFC 6749 Section 10.15: Open Redirectors</em> .</td></tr><tr class="table-even"><td>authorization.requireScope</td><td><code>true</code></td><td>Whether the scope for each access token requested is required.</td></tr></table>


<h2 id="approvalHandler">7.7 User Approval Configuration</h2>


The plugin provides support for the three <code>UserApprovalHandler</code> implementations provided by the underlying Spring OAuth library. This only applies to the authorization endpoint and allows you to configure the method of auto-approval used by the application. The following properties determine which method of auto-approval to use and how it is configured:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default Value</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>auto</td><td><code>EXPLICIT</code></td><td>Determines which method of auto-approval to use. The value is determined by <code>grails.plugin.springsecurity.oauthProvider.approval.UserApprovalSupport</code> and must be <code>EXPLICIT</code>, <code>TOKEN_STORE</code> or <code>APPROVAL_STORE</code>.</td></tr><tr class="table-even"><td>handleRevocationAsExpiry</td><td><code>false</code></td><td>When configured to use an approval store for auto-approval, this determines if approval revocation should expire the corresponding approval instance (<code>true</code>) or delete the approval (<code>false</code>) outright.</td></tr><tr class="table-odd"><td>approvalValiditySeconds</td><td><code>60 &#42; 60 &#42; 24 &#42; 30</code></td><td>When configured to use an approval store for auto-approval, the length of time that an approval will be valid after it has been granted.</td></tr><tr class="table-even"><td>scopePrefix</td><td><code>'scope.'</code></td><td>When configured to use an approval store for auto-approval, the prefix added to approved scopes as part of the auto-approval process.</td></tr></table><p class="paragraph"/>The <code>auto</code> property determines which of the three <code>UserApprovalHandler</code> provided by Spring OAuth will be used.<p class="paragraph"/>The default option is to require explicit approval for every authorization and is equivalent to setting <code>auto</code> to <code>EXPLICIT</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.oauthprovider.approval.auto = UserApproval.EXPLICIT</pre></div><p class="paragraph"/>Auto-approval based on previously issued access tokens is supported via the <code>TokenStoreUserApprovalHandler</code> provided by Spring OAuth and can be configured by setting <code>auto</code> to <code>TOKEN_STORE</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.oauthprovider.approval.auto = UserApproval.TOKEN_STORE</pre></div><p class="paragraph"/>Auto-approval based on prior approvals is supported via the <code>ApprovalStoreUserApprovalHandler</code> provided by Spring OAuth and can be configured by setting <code>auto</code> to <code>APPROVAL_STORE</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.oauthprovider.approval.auto = UserApproval.APPROVAL_STORE</pre></div><p class="paragraph"/>The plugin will configure the <code>TokenStoreUserApprovalHandler</code> and <code>ApprovalStoreUserApprovalHandler</code> to use the GORM backed <code>TokenStore</code> and <code>ApprovalStore</code> respectively.<p class="paragraph"/>Please consult Spring OAuth directly for more information on the usage of the <code>TokenStore</code> and <code>ApprovalStore</code> methods of auto-approval.



<h2 id="defaultClientConfig">7.8 Default Client Configuration</h2>


An application can use the following properties to define the default values that will be used when creating a <code>ClientDetails</code> instance if a client has not specified a value. The default configuration will not allow a client to retrieve an access token unless they have explicitly registered support for the requested grant type.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default Value</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>defaultClientConfig.resourceIds</td><td><code>&#91;&#93;</code></td><td>Resources the client is authorized to access. This is currently unused as access to resources is controlled by Spring Security Core's rules.</td></tr><tr class="table-even"><td>defaultClientConfig.authorizedGrantTypes</td><td><code>&#91;&#93;</code></td><td>Grant types the client supports.</td></tr><tr class="table-odd"><td>defaultClientConfig.scope</td><td><code>&#91;&#93;</code></td><td>Scope to use for each access token request.</td></tr><tr class="table-even"><td>defaultClientConfig.autoApproveScopes</td><td><code>&#91;&#93;</code></td><td>Scopes to auto-approve for authorization requests. Including a value of <code>true</code> in the list will auto-approve all scopes for clients using the default configuration.</td></tr><tr class="table-odd"><td>defaultClientConfig.registeredRedirectUri</td><td><code>null</code></td><td>URI to redirect the user-agent to during an authorization code or implicit grant.</td></tr><tr class="table-even"><td>defaultClientConfig.authorities</td><td><code>&#91;&#93;</code></td><td>Roles and authorities granted to the client.</td></tr><tr class="table-odd"><td>defaultClientConfig.accessTokenValiditySeconds</td><td><code>null</code></td><td>The length of time that an access token will be valid after it has been issued. This is used instead of the length configured for token services if available.</td></tr><tr class="table-even"><td>defaultClientConfig.refreshTokenValiditySeconds</td><td><code>null</code></td><td>The length of time that a refresh token will be valid after it has been issued. This is used instead of the length configured for token services if available.</td></tr><tr class="table-odd"><td>defaultClientConfig.additionalInformation</td><td><code>&#91;:&#93;</code></td><td>Additional information about the client. This is not required by OAuth 2.0 but is exposed in the underlying Spring library.</td></tr></table>


<h2 id="filterChainConfig">7.9 Filter Chain Configuration</h2>


Spring Security Core plugin's <code>securityContextPersistenceFilter</code> stores state in the HTTP session. Access to the token endpoint and OAuth 2.0 resources must be stateless.<p class="paragraph"/>By default, the OAuth2 plugin will register the <code>statelessSecurityContextPersistenceFilter</code> in the filter chain after the <code>securityContextPersistenceFilter</code> provided by the Spring Security Core plugin. This is provided as a convenience for the plugin consumer, so they can remove one filter or the other to easily achieve stateful or stateless request handling. See the example below. This automatic filter registration can be disabled by setting the <code>registerStatelessFilter</code> configuration option to <code>false</code>.<p class="paragraph"/>The plugin registers an <code>OAuth2AuthenticationProcessingFilter</code> under the bean name <code>oauth2ProviderFilter</code>. This filter provides token authentication using the underlying token store for resource access.<p class="paragraph"/>The plugin registers a <code>ClientCredentialsTokenEndpointFilter</code> under the bean name <code>clientCredentialsTokenEndpointFilter</code>. This filter is responsible for authenticating the client specified in any OAuth 2.0 requests. The plugin also registers a <code>BasicAuthenticationFilter</code> under the bean name <code>oauth2BasicAuthenticationFilter</code>. This filter is responsible for authenticating the client via HTTP Basic authentication, which is the recommended method in the OAuth 2.0 specification.<p class="paragraph"/>Finally, the plugin registers an <code>ExceptionTranslationFilter</code> under the bean name <code>oauth2ExceptionTranslationFilter</code>. This filter is created with a <code>NullRequestCache</code> instance rather than the <code>HttpSessionRequestCache</code> instance that the Spring Security Core plugin provided <code>ExceptionTranslationFilter</code> is created with. Similar to the <code>statelessSecurityContextPersistenceFilter</code>, this filter is registered automatically by the plugin but can be disabled by setting the <code>registerExceptionTranslationFilter</code> configuration option to <code>false</code>.<p class="paragraph"/>The following filter chain configuration is recommended:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.filterChain.chainMap = &#91;
        &#91;pattern: '/oauth/token',               filters: 'JOINED_FILTERS,&#45;oauth2ProviderFilter,&#45;securityContextPersistenceFilter,&#45;logoutFilter,&#45;authenticationProcessingFilter,&#45;rememberMeAuthenticationFilter,&#45;exceptionTranslationFilter'&#93;,
        &#91;pattern: '/securedOAuth2Resources/&#42;&#42;', filters: 'JOINED_FILTERS,&#45;securityContextPersistenceFilter,&#45;logoutFilter,&#45;authenticationProcessingFilter,&#45;rememberMeAuthenticationFilter,&#45;oauth2BasicAuthenticationFilter,&#45;exceptionTranslationFilter'&#93;,
        &#91;pattern: '/&#42;&#42;',                        filters: 'JOINED_FILTERS,&#45;statelessSecurityContextPersistenceFilter,&#45;oauth2ProviderFilter,&#45;clientCredentialsTokenEndpointFilter,&#45;oauth2BasicAuthenticationFilter,&#45;oauth2ExceptionTranslationFilter'&#93;
&#93;</pre></div><p class="paragraph"/>The <code>oauth2ProviderFilter</code> and stateful <code>securityContextPersistenceFilter</code> and <code>exceptionTranslationFilter</code> are removed from the token endpoint's filter chain. With the <code>securityContextPersistenceFilter</code> removed, the <code>statelessSecurityContextPersistenceFilter</code> will be used to ensure access token requests are stateless. Similarly, removing the <code>exceptionTranslationFilter</code> will allow the <code>oauth2ExceptionTranslationFilter</code> to take its place in the filter chain.<p class="paragraph"/>The <code>securityContextPersistenceFilter</code> and <code>exceptionTranslationFilter</code> are also removed from the filter chain for OAuth 2.0 resources. However, the <code>oauth2ProviderFilter</code> must not be removed, as this filter is responsible for authenticating the OAuth 2.0 access token included in the request.<p class="paragraph"/>It is recommend that filter chain(s) for non-OAuth 2.0 resources have all OAuth 2.0 specific filters removed. These include: <code>statelessSecurityContextPersistenceFilter</code>, <code>oauth2ProviderFilter</code>, <code>clientCredentialsTokenEndpointFilter</code>, <code>basicAuthenticationFilter</code> and <code>oauth2ExceptionTranslationFilter</code>. It is also recommended that any unnecessary filters such as the <code>rememberMeAuthenticationFilter</code> and <code>authenticationProcessingFilter</code> are removed from the filter chains for the token endpoint and OAuth 2.0 resources.


<h2 id="domainClassCustomSerializationConfig">7.10 Domain Class Custom Serialization Configuration</h2>


The default behavior of the plugin is to serialize the <code>additionalInformation</code> and <code>scope</code> properties of the <code>Client</code> and <code>AccessToken</code> classes as a <code>Map&#60;String, Object&#62;</code> and <code>Set&#60;String&#62;</code> respectively. This is how the <a href="../ref/Scripts/s2-init-oauth2-provider.html" class="Scripts">s2-init-oauth2-provider</a> script will generate the domain classes. However, this might not be ideal for all plugin consumers who want more control over the serialization of these fields.<p class="paragraph"/>To accommodate these users, it is possible to override the default serialization method on a case-by-case basis. The plugin provides two interfaces to accomplish.<p class="paragraph"/>For the <code>additionalInformation</code> fields:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> grails.plugin.springsecurity.oauthprovider.serialization;<p class="paragraph"/><span class="java&#45;keyword">import</span> java.util.Map;<p class="paragraph"/><span class="java&#45;keyword">public</span> <span class="java&#45;keyword">interface</span> OAuth2AdditionalInformationSerializer &#123;<p class="paragraph"/>    <span class="java&#45;object">Object</span> serialize(Map&#60;<span class="java&#45;object">String</span>, <span class="java&#45;object">Object</span>&#62; additionalInformation);<p class="paragraph"/>    Map&#60;<span class="java&#45;object">String</span>, <span class="java&#45;object">Object</span>&#62; deserialize(<span class="java&#45;object">Object</span> additionalInformation);
&#125;</pre></div><p class="paragraph"/>For the <code>scope</code> field:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> grails.plugin.springsecurity.oauthprovider.serialization;<p class="paragraph"/><span class="java&#45;keyword">import</span> java.util.Set;<p class="paragraph"/><span class="java&#45;keyword">public</span> <span class="java&#45;keyword">interface</span> OAuth2ScopeSerializer &#123;<p class="paragraph"/>    <span class="java&#45;object">Object</span> serialize(Set&#60;<span class="java&#45;object">String</span>&#62; scopes);<p class="paragraph"/>    Set&#60;<span class="java&#45;object">String</span>&#62; deserialize(<span class="java&#45;object">Object</span> scopes);
&#125;</pre></div><p class="paragraph"/>By default, the plugin registers implementations that do little more than return the argument provided to each method. The following table shows which plugin provided Spring beans implement these interfaces and how they're used:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Bean Name</strong></th><th><strong class="bold">Interface Implemented</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td><code>clientAdditionalInformationSerializer</code></td><td><code>OAuth2AdditionalInformationSerializer</code></td><td>Handles deserialization of the <code>additionalInformation</code> property of the <code>Client</code> class into a <code>Map&#60;String, Object&#62;</code>. Only the <code>deserialize</code> method is used by the plugin at this time.</td></tr><tr class="table-even"><td><code>accessTokenAdditionalInformationSerializer</code></td><td><code>OAuth2AdditionalInformationSerializer</code></td><td>Handles serialization and deserialization of the <code>additionalInformation</code> property of the <code>AccessToken</code> class into a <code>Map&#60;String, Object&#62;</code>.</td></tr><tr class="table-odd"><td><code>accessTokenScopeSerializer</code></td><td><code>OAuth2ScopeSerializer</code></td><td>Handles serialization and deserialization of the <code>scope</code> property of the <code>AccessToken</code> class into a <code>Set&#60;String&#62;</code>.</td></tr></table><p class="paragraph"/>Overriding these beans in <code>resources.groovy</code> will allow the plugin consumer to customize how these fields are serialized. However, this will require the affected domain class to be modified to accommodate the change. For example, let's change the <code>AccessToken</code> to serialized its <code>additionalInformation</code> as JSON <code>String</code> and its <code>scope</code> as white space delimited <code>String</code>.<p class="paragraph"/>First, modify the <code>AccessToken</code> class to reflect the change in the storage of these fields:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> test.oauth2<p class="paragraph"/>class AccessToken &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> authenticationKey
    <span class="java&#45;object">byte</span>&#91;&#93; authentication<p class="paragraph"/>    <span class="java&#45;object">String</span> username
    <span class="java&#45;object">String</span> clientId<p class="paragraph"/>    <span class="java&#45;object">String</span> value
    <span class="java&#45;object">String</span> tokenType<p class="paragraph"/>    Date expiration
    <span class="java&#45;object">String</span> additionalInformation<p class="paragraph"/>    <span class="java&#45;object">String</span> scope<p class="paragraph"/>    <span class="java&#45;keyword">static</span> hasOne = &#91;refreshToken: <span class="java&#45;object">String</span>&#93;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> constraints = &#123;
        username nullable: <span class="java&#45;keyword">true</span>
        clientId nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>
        value nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        tokenType nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>
        expiration nullable: <span class="java&#45;keyword">false</span>
        scope nullable: <span class="java&#45;keyword">false</span>
        refreshToken nullable: <span class="java&#45;keyword">true</span>
        authenticationKey nullable: <span class="java&#45;keyword">false</span>, blank: <span class="java&#45;keyword">false</span>, unique: <span class="java&#45;keyword">true</span>
        authentication nullable: <span class="java&#45;keyword">false</span>, minSize: 1, maxSize: 1024 &#42; 4
        additionalInformation nullable: <span class="java&#45;keyword">true</span>
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        version <span class="java&#45;keyword">false</span>
        scope lazy: <span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>Next, implement the earlier described interfaces:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> test<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.plugin.springsecurity.oauthprovider.serialization.OAuth2ScopeSerializer
<span class="java&#45;keyword">import</span> org.springframework.security.oauth2.common.util.OAuth2Utils<p class="paragraph"/>class WhiteSpaceDelimitedStringScopeSerializer <span class="java&#45;keyword">implements</span> OAuth2ScopeSerializer &#123;<p class="paragraph"/>    @Override
    <span class="java&#45;object">Object</span> serialize(Set&#60;<span class="java&#45;object">String</span>&#62; scopes) &#123;
        <span class="java&#45;keyword">return</span> OAuth2Utils.formatParameterList(scopes)
    &#125;<p class="paragraph"/>    @Override
    Set&#60;<span class="java&#45;object">String</span>&#62; deserialize(<span class="java&#45;object">Object</span> scopes) &#123;
        <span class="java&#45;keyword">return</span> OAuth2Utils.parseParameterList(scopes)
    &#125;
&#125;</pre></div><p class="paragraph"/>And:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> test<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.plugin.springsecurity.oauthprovider.serialization.OAuth2AdditionalInformationSerializer
<span class="java&#45;keyword">import</span> groovy.json.JsonOutput
<span class="java&#45;keyword">import</span> groovy.json.JsonSlurper<p class="paragraph"/>class JsonAdditionalInformationSerializer <span class="java&#45;keyword">implements</span> OAuth2AdditionalInformationSerializer &#123;<p class="paragraph"/>    @Override
    <span class="java&#45;object">Object</span> serialize(Map&#60;<span class="java&#45;object">String</span>, <span class="java&#45;object">Object</span>&#62; additionalInformation) &#123;
        JsonOutput.toJson(additionalInformation)
    &#125;<p class="paragraph"/>    @Override
    Map&#60;<span class="java&#45;object">String</span>, <span class="java&#45;object">Object</span>&#62; deserialize(<span class="java&#45;object">Object</span> additionalInformation) &#123;
        <span class="java&#45;keyword">new</span> JsonSlurper().parseText(additionalInformation as <span class="java&#45;object">String</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
The <code>serialize</code> methods are guaranteed to receive a non-null argument, although they may be provided an empty collection. The <code>deserialize</code> methods are expected to return a non-null value.
</blockquote><p class="paragraph"/>Finally, in <code>resources.groovy</code>, override the appropriate beans:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> test.JsonAdditionalInformationSerializer
<span class="java&#45;keyword">import</span> test.WhiteSpaceDelimitedStringScopeSerializer<p class="paragraph"/>beans = &#123;
    // Other beans here<p class="paragraph"/>    accessTokenAdditionalInformationSerializer(JsonAdditionalInformationSerializer)
    accessTokenScopeSerializer(WhiteSpaceDelimitedStringScopeSerializer)
&#125;</pre></div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/domainClassProperties.html">&lt;&lt; <strong>6</strong><span>Domain Class Properties</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/standaloneResourceAuthorizationServer.html"><strong>8</strong><span>Standalone Resource Server or Authorization Server</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Scripts</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-init-oauth2-approval.html">s2-init-oauth2-approval</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Scripts/s2-init-oauth2-provider.html">s2-init-oauth2-provider</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
